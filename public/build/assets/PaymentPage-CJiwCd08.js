import{r as p,j as e,a as x,b as u}from"./app-NW_fgNe6.js";import{r as s}from"./index-D7WRwVT8.js";import{Q as h,B as o}from"./react-toastify.esm-DX84-q2T.js";/* empty css                      */import{c as y,u as j}from"./index.es-DFlJMo9U.js";function P({paymentLink:a}){var m;const[n,l]=p.useState(!1);if(console.log("PaymentLink data:",a),!a)return e.jsxs(e.Fragment,{children:[e.jsx(x,{title:"Payment Link Not Found"}),e.jsx(h,{}),e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 via-white to-red-50 flex items-center justify-center p-4",children:e.jsx(s.Card,{className:"w-full max-w-md",children:e.jsxs(s.CardBody,{className:"text-center p-8",children:[e.jsx(s.Typography,{variant:"h4",color:"red",className:"mb-4",children:"Payment Link Not Found"}),e.jsx(s.Typography,{className:"text-gray-600",children:"The payment link you're trying to access is invalid or does not exist."})]})})})]});const d=async(r,t)=>{try{const c=await u.post("/pay/verify",{transaction_id:r,tx_ref:t});c.data.success?(o.success("Payment successful! Thank you."),setTimeout(()=>{window.location.href=`/pay/${a.link_code}/success`},2e3)):o.error(c.data.message||"Payment verification failed")}catch(c){console.error("Payment verification error:",c),o.error("Payment verification failed. Please contact support.")}finally{l(!1)}},i={public_key:"FLWPUBK-505ff9ef3205cff84de16c7170ee6d88-X",tx_ref:`PLK_${a.link_code}_${Date.now()}`,amount:parseFloat(((m=a.fees)==null?void 0:m.total_amount)||a.amount),currency:a.currency||"UGX",payment_options:"card,mobilemoney",customer:{email:a.customer_email||"customer@example.com",phone_number:a.customer_phone,name:a.customer_name},customizations:{title:a.company_name,description:a.purpose||"Payment",logo:a.company_logo||"https://biashari.com/images/user/shopkeeper360.png"},callback:r=>{console.log("Flutterwave Response:",r),y(),r.status==="successful"||r.status==="completed"?d(r.transaction_id,r.tx_ref):(o.error("Payment was not successful. Please try again."),l(!1))},onClose:()=>{console.log("Payment modal closed"),l(!1)}},f=j(i),g=async()=>{l(!0);try{const r=await u.post(`/pay/${a.link_code}/initiate`);r.data.success?(i.tx_ref=r.data.tx_ref,i.amount=r.data.payment_link.amount,f({callback:t=>{console.log("Flutterwave Response:",t),y(),t.status==="successful"||t.status==="completed"?d(t.transaction_id,t.tx_ref):(o.error("Payment was not successful. Please try again."),l(!1))},onClose:()=>{console.log("Payment modal closed"),l(!1)}})):(o.error(r.data.message||"Failed to initiate payment"),l(!1))}catch(r){console.error("Payment initiation error:",r),o.error("Failed to initiate payment. Please try again."),l(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(x,{title:`Payment - ${a.company_name}`}),e.jsx(h,{}),e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-blue-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-6",children:[a.company_logo?e.jsx("img",{src:a.company_logo,alt:a.company_name,className:"h-20 w-20 mx-auto mb-4 rounded-full object-cover border-4 border-white shadow-lg"}):e.jsx("div",{className:"h-20 w-20 mx-auto mb-4 rounded-full bg-blue-500 flex items-center justify-center text-white text-2xl font-bold border-4 border-white shadow-lg",children:(a.company_name||"B").charAt(0).toUpperCase()}),e.jsx(s.Typography,{variant:"h5",color:"blue-gray",className:"font-bold",children:a.company_name||"Business"}),e.jsx(s.Typography,{variant:"small",className:"text-gray-600",children:"Payment Request"})]}),e.jsxs(s.Card,{className:"shadow-xl",children:[e.jsxs(s.CardHeader,{floated:!1,shadow:!1,className:"rounded-t-lg bg-gradient-to-r from-blue-500 to-blue-600 p-6",children:[e.jsx(s.Typography,{variant:"h3",color:"white",className:"text-center font-bold",children:a.formatted_amount}),e.jsx(s.Typography,{variant:"small",color:"white",className:"text-center opacity-90 mt-1",children:"Amount to Pay"})]}),e.jsxs(s.CardBody,{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg space-y-3",children:[e.jsx(s.Typography,{variant:"small",className:"font-semibold text-gray-700 uppercase tracking-wide",children:"Payment Details"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(s.Typography,{variant:"small",className:"text-gray-600",children:"Customer Name:"}),e.jsx(s.Typography,{variant:"small",className:"font-semibold text-gray-900",children:a.customer_name})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(s.Typography,{variant:"small",className:"text-gray-600",children:"Phone Number:"}),e.jsx(s.Typography,{variant:"small",className:"font-semibold text-gray-900",children:a.customer_phone})]}),a.customer_email&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(s.Typography,{variant:"small",className:"text-gray-600",children:"Email:"}),e.jsx(s.Typography,{variant:"small",className:"font-semibold text-gray-900",children:a.customer_email})]})]})]}),a.purpose&&e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx(s.Typography,{variant:"small",className:"font-semibold text-blue-900 mb-2",children:"Purpose"}),e.jsx(s.Typography,{variant:"small",className:"text-blue-800",children:a.purpose})]}),a.fee_breakdown&&e.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gray-100 px-4 py-2 border-b border-gray-200",children:e.jsx(s.Typography,{variant:"small",className:"font-semibold text-gray-700 uppercase tracking-wide",children:"Payment Breakdown"})}),e.jsx("div",{className:"divide-y divide-gray-200",children:a.fee_breakdown.map((r,t)=>e.jsxs("div",{className:`flex justify-between items-center px-4 py-3 ${r.is_total?"bg-blue-50 font-semibold":"bg-white"}`,children:[e.jsx(s.Typography,{variant:"small",className:r.is_total?"text-blue-900 font-bold":"text-gray-700",children:r.label}),e.jsx(s.Typography,{variant:"small",className:r.is_total?"text-blue-900 font-bold text-lg":"text-gray-900",children:r.formatted})]},t))})]}),e.jsx("div",{className:"pt-4",children:e.jsx(s.Button,{size:"lg",color:"blue",className:"w-full flex items-center justify-center gap-2",onClick:g,disabled:n,children:n?e.jsxs(e.Fragment,{children:[e.jsx(s.Spinner,{className:"h-5 w-5"}),"Preparing Payment..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"})}),"Pay ",a.formatted_amount]})})}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-gray-500 pt-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z",clipRule:"evenodd"})}),e.jsx(s.Typography,{variant:"small",className:"text-xs",children:"Secured by Flutterwave"})]})]})]}),e.jsx("div",{className:"text-center mt-6",children:e.jsx(s.Typography,{variant:"small",className:"text-gray-500",children:"Powered by Biashari"})})]})})]})}export{P as default};
