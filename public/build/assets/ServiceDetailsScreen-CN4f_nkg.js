import{r as a,W as ee,j as e,y as u,a as te}from"./app-D2NLOtae.js";import{R as se}from"./Receipt-BKNkc3Hw.js";import{X as re}from"./index.es-Dw4fVMrN.js";import{L as ne}from"./Layout-DNaUaIuD.js";import{S as ae}from"./react-select.esm-BNHUSEW-.js";import{Q as oe,B as c}from"./react-toastify.esm-YHAwkjFx.js";/* empty css                      */import{l as P}from"./index-BJ6rOFXT.js";import{r as n}from"./index-C8m7lxvO.js";const le=[{name:e.jsx("b",{children:"Item"}),selector:r=>r.product.name,wrap:!0},{name:e.jsx("b",{children:"Qty"}),selector:r=>r.quantity,grow:!0,width:"60px",right:!0},{name:e.jsx("b",{children:"Price"}),selector:r=>Intl.NumberFormat("en-US").format(r.product.retail_price),grow:!0,width:"90px",right:!0}],ce=a.forwardRef(({company:r,props:h})=>(console.log(h),ee(),e.jsxs("div",{className:"text-sm text-uppercase monospace",children:[e.jsxs("div",{className:"w-full items-center justify-center space-x-5",children:[e.jsx("div",{className:"flex items-center justify-center w-full",children:e.jsx("img",{src:"/"+r.company.logo,alt:"facility logo",className:"h-20 object-contain rounded-lg mb-2"})}),e.jsxs("div",{className:"flex flex-col mb-4 items-center",children:[e.jsx("div",{className:"text-lg",children:r.company.name}),e.jsxs("div",{className:"my-1",children:["No. ",h.receipts.sale_id]}),e.jsx("div",{children:new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"})}),e.jsx("div",{className:"font-bold mt-1",children:"CUSTOMER BILL"})]})]}),e.jsx(re,{columns:le,data:h.receipts.sales}),e.jsx("table",{className:"w-full mt-2 bg-transparent",children:e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{className:"font-semibold text-start pl-5 py-2",children:"TOTAL"}),e.jsx("td",{className:"text-end pr-5 font-semibold py-2",children:"UGX "+Intl.NumberFormat("en-US").format(parseFloat(h.receipts.sale_total))})]})})}),e.jsxs("div",{className:"flex justify-between mt-5",children:[e.jsx("div",{className:"text-start pl-5",children:"Served by"}),e.jsx("div",{className:"text-end pr-5",children:r.user.name})]}),e.jsxs("div",{className:"flex flex-col mt-5 mb-4 items-center",children:[e.jsx("div",{children:"Thank you for supporting us!"}),e.jsx("div",{children:r.company.contacts}),e.jsx("div",{children:r.company.location})]})]}))),ie=ce;function de({company:r,service:h,service_id:d,service_items:m,cart_items:o}){const[g,U]=a.useState(0),[p,D]=a.useState(""),[w,N]=a.useState(0),[S,T]=a.useState(0),[A,M]=a.useState(null),[C,O]=a.useState(null),[k,X]=a.useState(null),F=a.useRef(),B=a.useRef(),j=t=>O(t),f=t=>X(t),$=P.useReactToPrint({content:()=>F.current,onAfterPrint:()=>{j(),u.visit(`/dashboard/${r.company.slug}/service/panel`)}}),q=P.useReactToPrint({content:()=>B.current,onAfterPrint:()=>f()}),[E,v]=a.useState([]),[y,I]=a.useState(null),[G,R]=a.useState(""),[x,b]=a.useState(1);a.useEffect(()=>{if(m!=null&&m.data){const t=m.data.map(s=>({value:s.id,label:s.name,price:"UGX "+Intl.NumberFormat("en-US").format(s.retail_price)}));v(t)}},[m]),a.useEffect(()=>{let t=0;if(Array.isArray(o)&&o.forEach(s=>{var L;const i=parseFloat((L=s.product)==null?void 0:L.retail_price)||0,l=parseInt(s.quantity)||0;t+=i*l}),U(t),p){const s=parseFloat(p);N(s-t)}else N(0)},[o,p]);const H=async t=>{if(R(t),!t)return v(m.data.map(s=>({value:s.id,label:s.name,price:"UGX "+Intl.NumberFormat("en-US").format(s.retail_price)})));try{const i=(await axios.get(`/search_services?q=${t}&company_id=${r.company.id}`)).data.service_items.data.map(l=>({value:l.id,label:l.name,price:"UGX "+Intl.NumberFormat("en-US").format(l.retail_price)}));v(i)}catch(s){console.error("Search error:",s),v([])}},W=({label:t,price:s})=>e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold",children:t}),e.jsx("span",{className:"text-xs text-red-600 font-medium",children:s})]}),z=()=>{if(x>=1e3){c.error("Maximum quantity reached");return}b(t=>t+1)},Q=()=>{if(x<=1){c.error("Minimum quantity reached");return}b(t=>t-1)},V=()=>{if(!y){c.error("Please select a product");return}if(x<1){c.error("Quantity must be at least 1");return}const{value:t}=y,{id:s}=r.user,i=r.company.id,l=x;u.post("/addtoservice",{service_id:d,quantity:l,product_id:t,company_id:i,user_id:s},{preserveScroll:!0,onSuccess:()=>{c.success(`${y.label} added to tab`),I(null),b(1),R("")}})},J=t=>{const s=t.target.value;T(s),N(parseFloat(s)+(parseFloat(p)-parseFloat(g)))},K=(t,s)=>{const i=r.company.id;u.post("/delete_service_item",{itemId:t,company_id:i,service_id:d},{preserveScroll:!0,onSuccess:()=>{c.success(`${s} removed`)}})},Y=()=>{const t=r.company.id;u.post("/empty_service_items",{company_id:t,service_id:d},{preserveScroll:!0,onSuccess:()=>{c.success("Tab cleared"),u.visit(`/dashboard/${r.company.slug}/service/panel`)}})},Z=async()=>{if(!o.length){c.error("Cannot proceed with an empty cart");return}const t=r.company.id,s=g,i=S;u.post("/record_service_sale",{service_id:d,company_id:t,sale_total:s,discount:i},{preserveScroll:!0,onSuccess:async()=>{c.success("Sale recorded successfully");try{const l=await axios.get(`/getlastsale?company_id=${t}`);l.data&&(M(l.data),j("xl"))}catch(l){console.error("Error fetching receipt data:",l),c.error("Failed to load receipt")}}})},_=()=>{f("xl")};return e.jsxs("div",{className:"p-4",children:[e.jsx(te,{title:"Service Details"}),e.jsx(oe,{}),e.jsx("div",{className:"mb-4",children:e.jsxs("span",{children:["Service ID: ",e.jsx("span",{className:"text-red-800",children:d})]})}),e.jsxs("div",{className:"bg-white shadow-xl rounded-2xl p-5 mb-2 grid grid-cols-1 md:grid-cols-3 gap-6 items-end",children:[e.jsx(ae,{value:y,onChange:I,options:E,onInputChange:H,inputValue:G,placeholder:"Search service/item...",formatOptionLabel:W,noOptionsMessage:()=>"No item found",className:"w-full",styles:{control:(t,s)=>({...t,borderColor:s.isFocused?"#3B82F6":"#A5B4FC"})}}),e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("button",{onClick:Q,disabled:x<=1,className:"bg-green-600 text-white rounded-full w-10 h-10 flex justify-center items-center disabled:opacity-50",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M20 12H4"})})}),e.jsx("input",{type:"number",min:"1",max:"1000",value:x,onChange:t=>{const s=parseInt(t.target.value);b(isNaN(s)?1:Math.max(1,Math.min(1e3,s)))},className:"w-16 text-center border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-green-500"}),e.jsx("button",{onClick:z,className:"bg-green-600 text-white rounded-full w-10 h-10 flex justify-center items-center",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 6v12m6-6H6"})})})]}),e.jsxs("button",{onClick:V,className:"bg-gradient-to-r from-green-500 to-blue-500 hover:from-secondary hover:to-primary text-white py-2 rounded-md flex items-center justify-center",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",className:"w-5 h-5 mr-2",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})}),"Add to Cart"]})]}),!!o.length&&e.jsx("div",{className:"bg-gradient-to-br from-white to-slate-50 border mb-2 p-5 rounded-2xl shadow-xl space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-1 gap-3",children:[e.jsx(n.Input,{type:"number",label:"Amount Received",value:p,onChange:t=>D(t.target.value)}),(o==null?void 0:o.length)>0&&e.jsx(n.Input,{type:"number",label:"Discount Amount",value:S,onChange:J})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-1 gap-6",children:[e.jsxs("div",{className:"flex justify-between items-end w-full",children:[e.jsx("div",{className:"",children:w>0&&e.jsxs(e.Fragment,{children:[e.jsx(n.Typography,{className:"text-sm text-gray-500",children:"Change to Return"}),e.jsxs(n.Typography,{className:"text-lg font-semibold text-green-600",children:["UGX ",Intl.NumberFormat("en-US").format(w)]})]})}),e.jsxs("div",{className:"text-right",children:[e.jsx(n.Typography,{className:"text-sm text-gray-500",children:"Total"}),e.jsxs(n.Typography,{className:"text-xl font-black text-gray-900",children:["UGX ",Intl.NumberFormat("en-US").format(g)]})]})]}),e.jsx("div",{className:"w-full sm:w-auto text-right",children:e.jsx(n.Button,{className:"bg-gradient-to-r from-green-500 to-blue-500 hover:from-secondary hover:to-primary",onClick:Z,children:"Record Sale"})})]})]})}),(o==null?void 0:o.length)>0&&e.jsxs("div",{className:"bg-white rounded-xl shadow-md overflow-hidden",children:[e.jsxs("div",{className:"flex justify-between items-center bg-green-100 px-4 py-3",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Items"}),e.jsxs("button",{onClick:_,className:"bg-green-600 text-white py-1 px-3 rounded flex items-center text-sm",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",className:"w-5 h-5 mr-1",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2"})}),"Print Bill"]})]}),e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Product"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Price (UGX)"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Qty"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold print:hidden",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:o.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:t.product.name}),e.jsx("td",{className:"px-4 py-3 text-sm",children:Intl.NumberFormat("en-US").format(t.product.retail_price)}),e.jsx("td",{className:"px-4 py-3 text-sm",children:t.quantity}),e.jsx("td",{className:"px-4 py-3 text-right print:hidden",children:e.jsx("button",{onClick:()=>K(t.id,t.product.name),className:"text-red-500 hover:text-red-700",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})})]},t.id))})]}),e.jsx("div",{className:"flex justify-end bg-green-100 px-4 py-3 mt-4",children:e.jsx("button",{onClick:Y,className:"bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded",children:"Clear Cart"})})]}),e.jsxs(n.Dialog,{open:C==="xl",size:C,handler:j,children:[e.jsx(n.DialogHeader,{children:"Print Receipt"}),e.jsx(n.DialogBody,{className:"max-h-[30rem] overflow-auto",children:e.jsx("div",{ref:F,children:e.jsx(se,{company:r,props:A})})}),e.jsxs(n.DialogFooter,{children:[e.jsx(n.Button,{color:"red",onClick:j,children:"Close"}),e.jsx(n.Button,{color:"green",onClick:$,children:"Print"})]})]}),e.jsxs(n.Dialog,{open:k==="xl",size:k,handler:f,children:[e.jsx(n.DialogHeader,{children:"Print Bill"}),e.jsx(n.DialogBody,{className:"max-h-[30rem] overflow-auto",children:e.jsx("div",{ref:B,children:e.jsx(ie,{company:r,props:{receipts:{sale_id:d,sale_total:g,sales:o}}})})}),e.jsxs(n.DialogFooter,{children:[e.jsx(n.Button,{color:"red",onClick:f,children:"Close"}),e.jsx(n.Button,{color:"green",onClick:q,children:"Print"})]})]})]})}de.layout=r=>e.jsx(ne,{children:r,props:r.props.company});export{de as default};
