import{r as o,j as t,a as me,y as v}from"./app-CGou5Y8K.js";import{L as ge}from"./Layout-Dd9R_5FO.js";import{S as X}from"./react-select.esm-WaSjTFLP.js";import{r as n}from"./index-Bck5AY-o.js";import{C as he}from"./compressor.esm-BndlrjPy.js";import{X as xe}from"./index.es-Bkkq-pYS.js";import{Q as fe,B as l}from"./react-toastify.esm-BKYMzSy8.js";/* empty css                      */function ye({company:d,products:u,product:S,category:g}){console.log(u);const[E,Q]=o.useState(""),[ve,F]=o.useState(u.current_page),[k,Z]=o.useState(""),[G,z]=o.useState(null),J=e=>{z(e),A(e.value),_(e.product),console.log(e)},[O,A]=o.useState(""),[h,B]=o.useState(""),[j,L]=o.useState(""),[K,_]=o.useState(""),[i,H]=o.useState(null),[Y,M]=o.useState(null),[ee,b]=o.useState(""),[x,C]=o.useState(""),[w,I]=o.useState(""),[te,D]=o.useState(""),[R,$]=o.useState(null),[re,N]=o.useState(null),q=(e,a=!1)=>{const r=e.target.files[0];if(!r)return;const s=a?$:H;r.size>1024*1024?new he(r,{quality:.6,maxWidth:1920,maxHeight:1920,success(c){const m=new File([c],r.name,{type:r.type||"image/jpeg",lastModified:Date.now()});console.log("Compressed file:",m.name,m.size,m.type),s(m)},error(c){console.error("Compression error:",c.message),s(r)}}):(console.log("Original file:",r.name,r.size,r.type),s(r))},ae=e=>{v.get(`/dashboard/${d.company.slug}/online-portal/product`,{page:e,search:E},{preserveState:!0})},oe=e=>{F(e),ae(e)},se=e=>{e.preventDefault(),Q(e.target.value),F(1);var a=e.target.value;v.get(`/dashboard/${d.company.slug}/online-portal/product`,{search:a,page:1},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{}})},ne=e=>{M(e.id),b(e.product_id),C(e.category_id),I(e.description),D(e.product.name),N({value:e.product.id,label:e.product.name,product:e.product.name}),y("xl")},le=async e=>{e.preventDefault();var a=d.company_id;if(x=="0"||x==""){l.error("Select the category");return}if(w==""){l.error("Description is required");return}const r=new FormData;r.append("companyId",a),r.append("productId",ee),r.append("categoryId",x),R&&r.append("image",R),r.append("description",w),r.append("productName",te),l.loading("Updating product...");try{v.post(`/update-online-product/${Y}`,r,{forceFormData:!0,preserveState:!0,onSuccess:()=>{l.dismiss(),l.success("Product updated successfully"),y(null),M(null),b(""),C(""),I(""),D(""),$(null),N(null)},onError:s=>{l.dismiss(),console.error("Errors:",s);const c=s.error||s.image||"Failed to update product.";l.error(c)}})}catch(s){l.dismiss(),l.error(s.message||"An error occurred")}},ce=async e=>{e.preventDefault();var a=d.company_id;if(i==null){l.error("Product Image is a must Online");return}else if(O==""){l.error("Select the product");return}else if(h=="0"||h==""){l.error("Select the category");return}else if(j==""){l.error("Description is required");return}console.log("Submitting product with image:",{name:i==null?void 0:i.name,size:i==null?void 0:i.size,type:i==null?void 0:i.type,isFile:i instanceof File,isBlob:i instanceof Blob});const r=new FormData;r.append("companyId",a),r.append("productId",O),r.append("categoryId",h),r.append("image",i),r.append("description",j),r.append("productName",K),l.loading("Adding product...");try{v.post("/add-online-product",r,{forceFormData:!0,preserveState:!0,onSuccess:s=>{console.log("Success - Product added!"),l.dismiss(),l.success("Product added successfully"),f(null),A(""),B(""),L(""),_(""),H(null),z(null)},onError:s=>{console.log("Error callback triggered:",s),l.dismiss(),console.error("Errors:",s);const c=s.error||s.image||"Failed to add product. Please try again.";l.error(c)}})}catch(s){l.dismiss(),console.error("Catch error:",s),l.error(s.message||"An error occurred")}},[T,p]=o.useState([]);o.useEffect(()=>{var e=S.data.map(a=>({value:a.id,label:String(a.name),product:a.name}));p(e)},[S]);const W=async e=>{if(Z(e),!e){var a=S.data.map(c=>({value:c.id,label:String(c.name),product:c.name}));p(a);return}try{var r=d.company_id;const c=await axios.get(`/search_stock?q=${e}&company_id=${r}`);if(console.log("full response",c.data),c.data.product.data&&c.data.product.data){console.log("pro data:",c.data.product.data);var s=c.data.product.data.map(P=>({value:P.id,label:String(P.name),product:P.name}));p(s)}else console.error("unexpected"),p([])}catch(c){console.error("Error fetching products:",c),p([])}},[U,ie]=o.useState(null),f=e=>ie(e),[V,de]=o.useState(null),y=e=>de(e),ue={headRow:{style:{backgroundColor:"#f8fafc"}},headCells:{style:{fontWeight:"bold",fontSize:"13px",textTransform:"uppercase",color:"#4CAF50"}},rows:{style:{minHeight:"50px"},highlightOnHoverStyle:{backgroundColor:"#f1f5f9",cursor:"pointer"}}},pe=[{selector:e=>t.jsx("img",{className:"h-28 w-28 object-cover rounded-md",src:"/"+e.image})},{name:"Name",selector:e=>e.product.name},{name:"Category",selector:e=>e.category.name},{name:"Description",selector:e=>e.description},,{name:"Added On",selector:e=>new Date(e.created_at).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"})},{name:"Action",selector:e=>t.jsx("button",{onClick:()=>ne(e),className:"p-2 bg-green-600 rounded hover:bg-green-700",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"white",className:"w-4 h-4",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"})})})}];return t.jsxs("div",{children:[t.jsx(me,{children:t.jsx("title",{children:"Online Products & Services"})}),t.jsx(xe,{title:t.jsxs("div",{className:"p-2 flex flex-col md:flex-row items-start md:items-center justify-between border-b border-primary pb-3",children:[t.jsx("span",{className:"text-lg font-medium",children:"Online Products"}),t.jsxs("div",{className:"flex items-center space-x-2 mt-2 md:mt-0 w-full md:w-1/2",children:[t.jsx(n.Input,{type:"text",label:"Search",value:E,onChange:se}),t.jsxs(n.Button,{onClick:()=>f("xl"),className:" bg-gradient-to-r from-primary to-secondary text-white flex items-center gap-2 h-10",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})}),"Add"]})]})]}),columns:pe,data:u.data,customStyles:ue,pointerOnHover:!0,onRowClicked:(e,a)=>!children&&ExpandableComponent?null:editRow(e,a),highlightOnHover:!0,pagination:!0,paginationServer:!0,paginationTotalRows:u.total,paginationPerPage:u.per_page,onChangePage:oe,paginationRowsPerPageOptions:[]}),t.jsx(o.Fragment,{children:t.jsxs(n.Dialog,{open:U==="xl",size:U,handler:f,children:[t.jsx(n.DialogHeader,{children:t.jsx(n.Typography,{variant:"h5",color:"blue-gray",children:"Add a product"})}),t.jsxs("form",{onSubmit:ce,children:[t.jsxs(n.DialogBody,{divider:!0,className:"h-[28rem] overflow-scroll grid place-items-center gap-4",children:[t.jsx(n.Input,{label:"Company Logo",accept:".jpg,.jpeg,.png",size:"md",type:"file",onChange:q}),t.jsx(X,{className:"w-full",value:G,onChange:J,options:T,isClearable:!0,placeholder:"Search for a product...",onInputChange:W,inputValue:k,loadingMessage:"searching..",styles:{control:(e,a)=>({...e,borderColor:(a.isFocused,"brown")})}}),t.jsxs("select",{className:"w-full",value:h,onChange:e=>B(e.target.value),children:[t.jsx("option",{value:0,className:"bg-gray-200",children:" Select the category......."}),g&&g.map((e,a)=>t.jsxs("option",{value:e.id,children:[" ",e.name]}))]}),t.jsx(n.Input,{label:"Description",value:j,onChange:e=>L(e.target.value),size:"sm"})]}),t.jsxs(n.DialogFooter,{className:"space-x-2",children:[t.jsx(n.Button,{onClick:f,variant:"gradient",color:"blue-gray",children:"Close"}),t.jsx(n.Button,{type:"submit",className:"bg-primary",children:"Add"})]})]})]})}),t.jsx(o.Fragment,{children:t.jsxs(n.Dialog,{open:V==="xl",size:V,handler:y,children:[t.jsx(n.DialogHeader,{children:t.jsx(n.Typography,{variant:"h5",color:"blue-gray",children:"Edit Product"})}),t.jsxs("form",{onSubmit:le,children:[t.jsxs(n.DialogBody,{divider:!0,className:"h-[28rem] overflow-scroll grid place-items-center gap-4",children:[t.jsx(n.Input,{label:"Product Image (Optional)",accept:".jpg,.jpeg,.png",size:"md",type:"file",onChange:e=>q(e,!0)}),t.jsx(X,{className:"w-full",value:re,onChange:e=>{N(e),b(e.value),D(e.product)},options:T,isClearable:!0,placeholder:"Search for a product...",onInputChange:W,inputValue:k,loadingMessage:"searching..",styles:{control:(e,a)=>({...e,borderColor:(a.isFocused,"brown")})}}),t.jsxs("select",{className:"w-full",value:x,onChange:e=>C(e.target.value),children:[t.jsx("option",{value:0,className:"bg-gray-200",children:"Select the category......."}),g&&g.map((e,a)=>t.jsx("option",{value:e.id,children:e.name},a))]}),t.jsx(n.Input,{label:"Description",value:w,onChange:e=>I(e.target.value),size:"sm"})]}),t.jsxs(n.DialogFooter,{className:"space-x-2",children:[t.jsx(n.Button,{onClick:()=>y(null),variant:"gradient",color:"blue-gray",children:"Close"}),t.jsx(n.Button,{type:"submit",className:"bg-primary",children:"Update"})]})]})]})}),t.jsx(fe,{})]})}ye.layout=d=>t.jsx(ge,{children:d,props:d.props.company});export{ye as default};
