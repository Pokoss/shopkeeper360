import{r,j as e,a as Q,y as v}from"./app-DewAYiJ4.js";import{L as V}from"./Layout-CDxvSKp5.js";import{S as Y}from"./react-select.esm-jP0B53I5.js";import{Q as J,B as d}from"./react-toastify.esm-DROA9hgh.js";/* empty css                      */import{R as K}from"./Receipt-BSb8c_V2.js";import{l as Z}from"./index-CVDLwE_z.js";import{r as a}from"./index-DLIpeVtA.js";import"./index.es-_NWYW-Ou.js";function ee({company:o,products:y,cart_items:c}){const[U,x]=r.useState([]),[$,b]=r.useState(null),[p,w]=r.useState(null),[h,S]=r.useState(0),[te,T]=r.useState(0),[C,N]=r.useState(0),[k,A]=r.useState(0),[g,_]=r.useState(),[f,j]=r.useState(1),[B,F]=r.useState(""),[P,L]=r.useState(null),m=t=>L(t),I=r.useRef(),M=Z.useReactToPrint({content:()=>I.current,onAfterPrint:()=>{m()},onPrintError:()=>{m()}}),R="bg-gradient-to-r from-green-500 to-blue-500 hover:from-secondary hover:to-primary text-white font-semibold px-6 py-3 rounded-xl transition-all duration-200 shadow-md";r.useEffect(()=>{const t=y.data.map(s=>({value:s.id,label:s.name,price:`UGX ${Intl.NumberFormat("en-US").format(s.retail_price)} / ${s.measurement.abbriviation}`,available:s.available}));x(t)},[y]),r.useEffect(()=>{if(g||N(0),c.length===0)return S(0);let t=0,s=0;c.forEach(n=>{t+=n.quantity*parseFloat(n.product.retail_price),s+=n.quantity*(parseFloat(n.product.retail_price)-parseFloat(n.product.cost_price))}),S(t),T(s)},[c,g]);const E=t=>{const s=t.target.value;_(s),N(s-h)},O=t=>{const s=t.target.value;A(s),N(parseFloat(s)+(parseFloat(g)-parseFloat(h)))},D=({label:t,price:s,available:n})=>e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:t}),e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-red-600",children:s}),e.jsx("span",{className:"text-gray-400",children:"Ex: Not specified"}),e.jsxs("span",{className:"text-green-600",children:[n," left"]})]})]}),q=async t=>{var n,i;F(t);const s=o.company_id;if(!t)return x(y.data.map(l=>({value:l.id,label:l.name,price:`UGX ${Intl.NumberFormat("en-US").format(l.retail_price)} / ${l.measurement.abbriviation}`,available:l.available})));try{const l=await axios.get(`/search_stock?q=${t}&company_id=${s}`),W=(((i=(n=l==null?void 0:l.data)==null?void 0:n.product)==null?void 0:i.data)||[]).map(u=>({value:u.id,label:u.name,price:`UGX ${Intl.NumberFormat("en-US").format(u.retail_price)} / ${u.measurement.abbriviation}`,available:u.available}));x(W)}catch(l){console.error(l),x([])}},G=()=>{if(f<1||!p)return d.error("Select item and quantity > 0");const t={quantity:f,product_id:p.value,company_id:o.company.id,user_id:o.user.id};v.post("/addtocart",t,{preserveScroll:!0,onSuccess:()=>{d.success(`${p.label} added to cart`),w(null),j(1),F("")}})},X=(t,s)=>{v.post("/delete_cart_item",{itemId:t,company_id:o.company.id},{preserveScroll:!0,onSuccess:()=>d.success(`${s} removed`)})},H=()=>{v.post("/empty_cart_item",{company_id:o.company.id},{preserveScroll:!0,onSuccess:()=>d.success("Cart Cleared")})};function z(){var t=o.company.id;if(c.length==0)d.error("You cant sale nothing");else{var s=h,n=k;v.post("/register_pay",{company_id:t,sale_total:s,discount:n},{preserveScroll:!0,onSuccess:async()=>{d.success("Success");try{const i=await axios.get(`/getlastsale?company_id=${t}`);i.data&&i.data?(b(i.data),m("xl"),_("")):(console.error("unexpected"),b(null))}catch(i){console.error("Error fetching products:",i),b(null)}}})}}return e.jsxs("div",{className:"p-4",children:[e.jsx(Q,{children:e.jsx("title",{children:"Point of Sale"})}),e.jsxs("div",{className:"bg-white shadow-xl rounded-2xl p-5 mb-2 grid grid-cols-1 md:grid-cols-3 gap-6 items-end",children:[e.jsx(Y,{value:p,onChange:w,formatOptionLabel:D,options:U,placeholder:"Search for a product...",onInputChange:q,noOptionsMessage:()=>"No product found",inputValue:B}),e.jsxs("div",{className:"flex gap-2 items-center justify-center",children:[e.jsx("button",{onClick:()=>j(t=>Math.max(0,t-1)),disabled:f<=1,className:"bg-blue-600 text-white rounded-full w-10 h-10 flex justify-center items-center disabled:opacity-50",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M20 12H4"})})}),e.jsx("input",{type:"number",min:"1",max:"1000",value:f,onChange:t=>{const s=parseInt(t.target.value);j(isNaN(s)?1:Math.max(1,Math.min(1e3,s)))},className:"w-16 text-center border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{onClick:()=>j(t=>Math.min(1e3,t+1)),className:"bg-blue-600 text-white rounded-full w-10 h-10 flex justify-center items-center",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 6v12m6-6H6"})})})]}),e.jsx(a.Button,{onClick:G,className:R,children:"Add to Cart"})]}),!!c.length&&e.jsx("div",{className:"bg-gradient-to-br from-white to-slate-50 border mb-2 p-5 rounded-2xl shadow-xl space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-1 gap-3",children:[e.jsx(a.Input,{label:"Amount Received",value:g,onChange:E,type:"number"}),e.jsx(a.Input,{label:"Discount Amount",value:k,onChange:O,type:"number"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-1 gap-6",children:[e.jsxs("div",{className:"flex justify-between items-end w-full",children:[e.jsx("div",{className:"",children:C>0&&e.jsxs(e.Fragment,{children:[e.jsx(a.Typography,{className:"text-sm text-gray-500",children:"Change to Return"}),e.jsxs(a.Typography,{className:"text-lg font-semibold text-green-600",children:["UGX ",Intl.NumberFormat("en-US").format(C)]})]})}),e.jsxs("div",{className:"text-right",children:[e.jsx(a.Typography,{className:"text-sm text-gray-500",children:"Total"}),e.jsxs(a.Typography,{className:"text-xl font-black text-gray-900",children:["UGX ",Intl.NumberFormat("en-US").format(h)]})]})]}),e.jsx("div",{className:"w-full sm:w-auto text-right",children:e.jsx(a.Button,{onClick:z,className:R,children:"Record Sale"})})]})]})}),!!c.length&&e.jsxs("div",{className:"bg-white p-5 rounded-2xl shadow-xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx(a.Typography,{variant:"h6",children:"Cart"}),e.jsx(a.Button,{color:"red",size:"sm",onClick:H,children:"Clear All"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Product"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Price (UGX)"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold",children:"Qty"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold print:hidden",children:"Action"})]})}),e.jsx("tbody",{children:c.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:t.product.name}),e.jsx("td",{className:"px-4 py-3 text-sm",children:Intl.NumberFormat("en-US").format(t.product.retail_price)}),e.jsx("td",{className:"px-4 py-3 text-sm",children:t.quantity}),e.jsx("td",{className:"px-4 py-3 text-right print:hidden",children:e.jsx("button",{onClick:()=>X(t.id,t.product.name),className:"text-red-500 hover:text-red-700",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})})]},t.id))})]})})]}),e.jsx(r.Fragment,{children:e.jsxs(a.Dialog,{open:P==="xl",size:P,handler:m,children:[e.jsx(a.DialogHeader,{children:e.jsx(a.Typography,{variant:"h5",color:"blue-gray",children:"Print Receipt"})}),e.jsx("form",{children:e.jsx(a.DialogBody,{divider:!0,className:"h-[29rem] overflow-scroll",children:e.jsx("div",{ref:I,children:e.jsx(K,{company:o,props:$})})})}),e.jsx(a.DialogFooter,{children:e.jsxs("div",{className:"flex w-full justify-between",children:[e.jsx(a.Button,{onClick:m,variant:"gradient",color:"red",children:"Ignore"}),e.jsx("div",{className:"space-x-2",children:e.jsx(a.Button,{onClick:M,type:"submit",className:"bg-green-500",children:"Print"})})]})})]})}),e.jsx(J,{})]})}ee.layout=o=>e.jsx(V,{children:o,props:o.props.company});export{ee as default};
