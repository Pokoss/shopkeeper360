import{r as n,j as e,y as v}from"./app-Bu8YrQwW.js";import{L as V}from"./Layout-BLt-FQAu.js";import{S as Y}from"./react-select.esm-DmdgX91S.js";import{B as c,Q as J}from"./react-toastify.esm-BH-okNmL.js";/* empty css                      */import{R as K}from"./Receipt-R7jzywFJ.js";import{l as Z}from"./index-qlktCnxS.js";import{r as u}from"./index-DnGoa-Tv.js";import"./index.es-CQI6l8Qv.js";function ee({company:d,products:x,cart_items:l}){console.log(x);const S=n.useRef(),L=Z.useReactToPrint({content:()=>S.current});n.useEffect(()=>{var t=x.data.map(r=>({value:r.id,label:String(r.name),price:"UGX "+Intl.NumberFormat("en-US").format(r.retail_price)+" / "+r.measurement.abbriviation,available:r.available}));m(t)},[x]);const[U,m]=n.useState([]),[_,j]=n.useState(null),[h,k]=n.useState(null),[f,y]=n.useState(0),[te,P]=n.useState(0),[R,w]=n.useState(0),[C,D]=n.useState(0),[b,B]=n.useState(),E=t=>{t.preventDefault(),B(t.target.value);var r=t.target.value-f;w(r)},O=t=>{t.preventDefault(),D(t.target.value);var r=parseFloat(t.target.value)+(parseFloat(b)-parseFloat(f));w(r)};n.useEffect(()=>{b==""&&w(0),l.length==0&&y(0);var t=0,r=0;l&&l.map(a=>{var s=a.quantity*parseFloat(a.product.retail_price);t=t+s,y(t);var o=a.quantity*(parseFloat(a.product.retail_price)-parseFloat(a.product.cost_price));r=r+o,P(r)})},[l,b]);const A=t=>{k(t),console.log(t.value)},[q,F]=n.useState(""),G=({value:t,label:r,available:a,price:s})=>e.jsxs("div",{style:{display:""},children:[e.jsx("div",{className:"text-normal font-semibold",children:r}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{className:"text-red-700 text-xs font-semibold",children:s}),e.jsx("div",{className:"text-gray-400 text-xs font-semibold",children:"Ex: Not specified"}),e.jsx("div",{className:"text-green-700 text-xs",children:a+" left"})]})]}),X=async t=>{var r=d.company_id;if(F(t),!t){var a=x.data.map(o=>({value:o.id,label:String(o.name),price:"UGX "+Intl.NumberFormat("en-US").format(o.retail_price)+" / "+o.measurement.abbriviation,available:o.available}));m(a);return}try{const o=await axios.get(`/search_stock?q=${t}&company_id=${r}`);if(o.data.product.data&&o.data.product.data){console.log("pro data:",o.data.product.data);var s=o.data.product.data.map(p=>({value:p.id,label:String(p.name),price:"UGX "+Intl.NumberFormat("en-US").format(p.retail_price)+" / "+p.measurement.abbriviation,available:p.available}));m(s)}else console.error("unexpected"),m([])}catch(o){console.error("Error fetching products:",o),m([])}};let[i,g]=n.useState(0);function M(){i==1e3?c.error("1000 is the max number"):(i=i+1,g(parseInt(i)))}function T(){i==0?c.error("Quantity below 0 is forbidden"):(i=i-1,g(parseInt(i)))}function Q(t,r){var a=d.company.id;v.post("/delete_cart_item",{itemId:t,company_id:a},{preserveScroll:!0,onSuccess:()=>{c.success(r+" removed")}})}function W(){var t=d.company.id;v.post("/empty_cart_item",{company_id:t},{preserveScroll:!0,onSuccess:()=>{y(0),c.success("Cart Cleared")}})}function $(){var t=d.company.id;if(l.length==0)c.error("You cant sale nothing");else{var r=f,a=C;v.post("/register_pay",{company_id:t,sale_total:r,discount:a},{preserveScroll:!0,onSuccess:async()=>{c.success("Success");try{const s=await axios.get(`/getlastsale?company_id=${t}`);console.log(s),s.data&&s.data?(console.log("pro data:",s.data),j(s.data),N("xl")):(console.error("unexpected"),j(null))}catch(s){console.error("Error fetching products:",s),j(null)}}})}}function z(){if(i<1)c.error("Quantity must be 1 or higher");else if(i=="")c.error("Input the quantity");else if(h==null)c.error("Select the item");else{var t=d.company.id,r=d.user.id,a=h.value,s=i;v.post("/addtocart",{quantity:s,product_id:a,company_id:t,user_id:r},{preserveScroll:!0,onSuccess:()=>{c.success(h.label+" added to cart"),k(null),g(0),F("")}})}}const[I,H]=n.useState(null),N=t=>H(t);return e.jsxs("div",{children:[e.jsxs("div",{className:"px-5 pt-1",children:[e.jsxs("div",{className:"w-full grid grid-cols-1 gap-3 sm:grid-cols-3 place-items-center class justify-center",children:[e.jsxs("div",{className:"w-full space-y-2 mt-2",children:[e.jsx(u.Input,{type:"number",label:"Amount received",value:b,onChange:E}),l&&l.length==0?e.jsx(e.Fragment,{}):e.jsx(u.Input,{type:"number",label:"Discount Amount",value:C,onChange:O})]}),e.jsx("div",{className:"font-bold text-xl",children:l&&l.length==0?e.jsx(e.Fragment,{}):e.jsxs("span",{className:"text-base font-semibold",children:["Change: UGX ",Intl.NumberFormat("en-US").format(R)]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-bold text-xl mb-1",children:["UGX ",Intl.NumberFormat("en-US").format(f),e.jsx("br",{})]}),e.jsx("button",{onClick:()=>$(),className:"py-2 px-10 rounded-md font-semibold text-base text-gray-100 bg-primary hover:bg-red-700",children:"Record Sale"})]})]}),e.jsxs("div",{className:"bg-gray-400 p-2 mt-7 w-full grid grid-cols-1 gap-3 sm:grid-cols-3 place-items-center class justify-center",children:[e.jsx(Y,{value:h,onChange:A,formatOptionLabel:G,options:U,isClearable:!0,placeholder:"Search for a product...",onInputChange:X,noOptionsMessage:()=>"No product found",inputValue:q,className:"w-full",styles:{control:(t,r)=>({...t,borderColor:(r.isFocused,"brown")})}}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:T,className:"bg-primary h-10 w-10 rounded-full flex justify-center items-center",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"white",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 12h14"})})}),e.jsx("input",{type:"number",required:!0,placeholder:"",form:"stock_item_form",className:"rounded-md w-16 flex [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",value:i,onChange:t=>g(t.target.value)}),e.jsx("button",{onClick:M,className:"bg-primary h-10 w-10 rounded-full flex justify-center items-center",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"white",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})})})]}),e.jsxs("button",{onClick:z,className:"rounded-md flex justify-center items bg-primary p-2 w-full sm:w-32",children:[" ",e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"white",className:"w-6 h-6 mr-1",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v6m3-3H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})})," Add"]})]}),l&&l.length==0?e.jsx(e.Fragment,{}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center bg-tertiary px-5 py-2 mt-5",children:[e.jsx("span",{className:"font-semibold text-base",children:"Cart"}),e.jsx("button",{onClick:()=>W(),className:"bg-red-400 py-1 px-5 rounded-md text-white hover:bg-primary md:mr-28",children:"Clear all"})]}),e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-2/6",children:"Product"}),e.jsx("th",{className:"w-1/6",children:"Price (UGX)"}),e.jsx("th",{className:"w-1/6",children:"Qty"}),e.jsx("th",{className:"w-1/6 print:hidden",children:"Action"})]})}),e.jsx("tbody",{className:"text-gray-600 dark:text-gray-100 ",children:l&&l.map(t=>e.jsxs("tr",{className:"w-full justify-end",children:[e.jsx("td",{onClick:()=>c.success(t.product.name),className:"cursor-pointer sm:px-3 py-2 px-1 border-b border-gray-200 dark:border-gray-800 w-1/3",children:t.product.name}),e.jsx("td",{className:"sm:px-3 py-2 px-1 border-b border-gray-200 dark:border-gray-800 ",children:Intl.NumberFormat("en-US").format(t.product.retail_price)}),e.jsx("td",{className:"sm:px-3 py-2 px-1 border-b border-gray-200 dark:border-gray-800",children:t.quantity}),e.jsx("td",{className:"sm:px-3 py-2 px-1 border-b border-gray-200 dark:border-gray-800",children:e.jsx("button",{onClick:()=>Q(t.id,t.product.name),className:"bg-red-400 rounded-md p-2",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"white",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"})})})})]},t.id))})]})]})]}),e.jsx(n.Fragment,{children:e.jsxs(u.Dialog,{open:I==="xl",size:I,handler:N,children:[e.jsx(u.DialogHeader,{children:e.jsx(u.Typography,{variant:"h5",color:"blue-gray",children:"Print Receipt"})}),e.jsx("form",{children:e.jsx(u.DialogBody,{divider:!0,className:"h-[29rem] overflow-scroll",children:e.jsx("div",{ref:S,children:e.jsx(K,{company:d,props:_})})})}),e.jsx(u.DialogFooter,{children:e.jsxs("div",{className:"flex w-full justify-between",children:[e.jsx(u.Button,{onClick:N,variant:"gradient",color:"red",children:"Ignore"}),e.jsx("div",{className:"space-x-2",children:e.jsx(u.Button,{onClick:L,type:"submit",className:"bg-green-500",children:"Print"})})]})})]})}),e.jsx(J,{})]})}ee.layout=d=>e.jsx(V,{children:d,props:d.props.company});export{ee as default};
