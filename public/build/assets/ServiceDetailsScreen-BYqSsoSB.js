import{r as t,y as m,j as e}from"./app-D9yz_mYF.js";import{R as J}from"./Receipt-CkNphx8Y.js";import{L as K}from"./Layout-IMbBziYn.js";import{r as u}from"./index-D9CkAxny.js";import{S as Z}from"./react-select.esm-CcQf5xCR.js";import{B as i,Q as U}from"./react-toastify.esm-DttkLq6R.js";/* empty css                      */import{l as ee}from"./index-ByXy4RM5.js";import"./index.es-z2Cxa8Vv.js";function re({company:a,service:se,service_id:p,service_items:j,cart_items:n}){const[h,S]=t.useState(0),[v,D]=t.useState(),[P,y]=t.useState(0),[k,R]=t.useState(0),[A,w]=t.useState(null),[C,B]=t.useState(null),F=t.useRef(),f=r=>B(r);function O(){f(),m.visit(`/dashboard/${a.company.slug}/service/panel`)}const _=ee.useReactToPrint({content:()=>F.current,onAfterPrint:()=>{f(),m.visit(`/dashboard/${a.company.slug}/service/panel`)}});t.useEffect(()=>{var r=j.data.map(s=>({value:s.id,label:String(s.name),price:"UGX "+Intl.NumberFormat("en-US").format(s.retail_price)}));x(r)},[j]),t.useEffect(()=>{v==""&&y(0),n.length==0&&S(0);var r=0;n&&n.map(s=>{var c=s.quantity*parseFloat(s.product.retail_price);r=r+c,S(r)})},[n,v]);const E=r=>{r.preventDefault(),R(r.target.value);var s=parseFloat(r.target.value)+(parseFloat(v)-parseFloat(h));y(s)},$=r=>{r.preventDefault(),D(r.target.value);var s=r.target.value-h;y(s)},[G,x]=t.useState([]),[g,I]=t.useState(null),[T,L]=t.useState(""),X=r=>{I(r)},q=async r=>{var s=a.company_id;if(L(r),!r){var c=j.data.map(d=>({value:d.id,label:String(d.name),price:"UGX "+Intl.NumberFormat("en-US").format(d.retail_price)}));x(c);return}try{const d=await axios.get(`/search_services?q=${r}&company_id=${s}`);if(d.data.service_items.data&&d.data.service_items.data){var o=d.data.service_items.data.map(N=>({value:N.id,label:String(N.name),price:"UGX "+Intl.NumberFormat("en-US").format(N.retail_price)}));x(o)}else console.error("unexpected"),x([])}catch(d){console.error("Error fetching services:",d),x([])}},M=({value:r,label:s,available:c,price:o})=>e.jsxs("div",{style:{display:""},children:[e.jsx("div",{className:"text-normal font-semibold",children:s}),e.jsx("div",{className:"flex justify-between",children:e.jsx("div",{className:"text-red-700 text-xs font-semibold",children:o})})]});let[l,b]=t.useState(0);function Q(){l==1e3?i.error("1000 is the max number"):(l=l+1,b(parseInt(l)))}function W(){l==0?i.error("Quantity below 0 is forbidden"):(l=l-1,b(parseInt(l)))}function z(){if(l<1)i.error("Quantity must be 1 or higher");else if(l=="")i.error("Input the quantity");else if(g==null)i.error("Select the service/item");else{var r=a.company.id,s=a.user.id,c=g.value,o=l;m.post("/addtoservice",{service_id:p,quantity:o,product_id:c,company_id:r,user_id:s},{preserveScroll:!0,onSuccess:()=>{i.success(g.label+" added to tab"),I(null),b(0),L("")}})}}function H(r,s){var c=a.company.id;m.post("/delete_service_item",{itemId:r,company_id:c,service_id:p},{preserveScroll:!0,onSuccess:()=>{i.success(s+" removed")}})}function V(){var r=a.company.id;m.post("/empty_service_items",{company_id:r,service_id:p},{preserveScroll:!0,onSuccess:()=>{i.success("Tab as been cleared"),m.visit(`/dashboard/${a.company.slug}/service/panel`)}})}function Y(){var r=a.company.id;if(n.length==0)i.error("You cant sale nothing");else{var s=h,c=k;m.post("/record_service_sale",{service_id:p,company_id:r,sale_total:s,discount:c},{preserveScroll:!0,onSuccess:async()=>{i.success("Success");try{const o=await axios.get(`/getlastsale?company_id=${r}`);o.data&&o.data?(w(o.data),f("xl")):(console.error("unexpected"),w(null))}catch(o){console.error("Error fetching products:",o),w(null)}}})}}return e.jsxs("div",{children:[e.jsxs("div",{className:"w-full",children:["Service id ",e.jsx("span",{className:"text-red-800",children:p})]}),e.jsxs("div",{className:"px-5 pt-1",children:[e.jsxs("div",{className:"w-full grid grid-cols-1 gap-3 sm:grid-cols-3 place-items-center class justify-center",children:[e.jsxs("div",{className:"w-full space-y-2 mt-2",children:[e.jsx(u.Input,{type:"number",label:"Amount received",value:v,onChange:$}),n&&n.length==0?e.jsx(e.Fragment,{}):e.jsx(u.Input,{type:"number",label:"Discount Amount",value:k,onChange:E})]}),e.jsx("div",{className:"font-bold text-xl",children:n&&n.length==0?e.jsx(e.Fragment,{}):e.jsxs("span",{className:"text-base font-semibold",children:["Change: UGX ",Intl.NumberFormat("en-US").format(P)]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-bold text-xl mb-1",children:["UGX ",Intl.NumberFormat("en-US").format(h),e.jsx("br",{})]}),e.jsx("button",{onClick:()=>Y(),className:"py-2 px-10 rounded-md font-semibold text-base text-gray-100 bg-primary hover:bg-red-700",children:"Record Sale"})]})]}),e.jsxs("div",{className:"bg-gray-400 p-2 mt-7 w-full grid grid-cols-1 gap-3 sm:grid-cols-3 place-items-center class justify-center",children:[e.jsx(Z,{value:g,onChange:X,formatOptionLabel:M,options:G,isClearable:!0,placeholder:"Search for service / item...",onInputChange:q,noOptionsMessage:()=>"No product found",inputValue:T,className:"w-full",styles:{control:(r,s)=>({...r,borderColor:(s.isFocused,"brown")})}}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:W,className:"bg-primary h-10 w-10 rounded-full flex justify-center items-center",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"white",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 12h14"})})}),e.jsx("input",{type:"number",required:!0,placeholder:"",form:"stock_item_form",className:"rounded-md w-16 flex [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",value:l,onChange:r=>b(r.target.value)}),e.jsx("button",{onClick:Q,className:"bg-primary h-10 w-10 rounded-full flex justify-center items-center",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"white",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})})})]}),e.jsxs("button",{onClick:z,className:"rounded-md flex justify-center items bg-primary p-2 w-full sm:w-32",children:[" ",e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"white",className:"w-6 h-6 mr-1",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v6m3-3H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})})," Add"]})]}),n&&n.length==0?e.jsx(e.Fragment,{}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center bg-tertiary px-5 py-2 mt-5",children:[e.jsx("span",{className:"font-semibold text-base",children:"Cart"}),e.jsx("button",{onClick:()=>V(),className:"bg-red-400 py-1 px-5 rounded-md text-white hover:bg-primary md:mr-28",children:"Clear all"})]}),e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-2/6",children:"Product"}),e.jsx("th",{className:"w-1/6",children:"Price (UGX)"}),e.jsx("th",{className:"w-1/6",children:"Qty"}),e.jsx("th",{className:"w-1/6 print:hidden",children:"Action"})]})}),e.jsx("tbody",{className:"text-gray-600 dark:text-gray-100 ",children:n&&n.map(r=>e.jsxs("tr",{className:"w-full justify-end",children:[e.jsx("td",{onClick:()=>i.success(r.product.name),className:"cursor-pointer sm:px-3 py-2 px-1 border-b border-gray-200 dark:border-gray-800 w-1/3",children:r.product.name}),e.jsx("td",{className:"sm:px-3 py-2 px-1 border-b border-gray-200 dark:border-gray-800 ",children:Intl.NumberFormat("en-US").format(r.product.retail_price)}),e.jsx("td",{className:"sm:px-3 py-2 px-1 border-b border-gray-200 dark:border-gray-800",children:r.quantity}),e.jsx("td",{className:"sm:px-3 py-2 px-1 border-b border-gray-200 dark:border-gray-800",children:e.jsx("button",{onClick:()=>H(r.id,r.product.name),className:"bg-red-400 rounded-md p-2",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"white",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"})})})})]},r.id))})]})]})]}),e.jsx(t.Fragment,{children:e.jsxs(u.Dialog,{open:C==="xl",size:C,handler:f,children:[e.jsx(u.DialogHeader,{children:e.jsx(u.Typography,{variant:"h5",color:"blue-gray",children:"Print Receipt"})}),e.jsx("form",{children:e.jsx(u.DialogBody,{divider:!0,className:"h-[29rem] overflow-scroll",children:e.jsx("div",{ref:F,children:e.jsx(J,{company:a,props:A})})})}),e.jsx(u.DialogFooter,{children:e.jsxs("div",{className:"flex w-full justify-between",children:[e.jsx(u.Button,{onClick:O,variant:"gradient",color:"red",children:"Ignore"}),e.jsx("div",{className:"space-x-2",children:e.jsx(u.Button,{onClick:_,type:"submit",className:"bg-green-500",children:"Print"})})]})})]})}),e.jsx(U,{}),e.jsx(U,{})]})}re.layout=a=>e.jsx(K,{children:a,props:a.props.company});export{re as default};
