import{r as a,W as oe,j as e,y as u}from"./app-BHIqqpm7.js";import{R as ie}from"./Receipt-qAFVMmpL.js";import{L as ce}from"./Layout-CaExgZK-.js";import{r as n}from"./index-CBc0B48a.js";import{S as de}from"./react-select.esm-PY0EMKNR.js";import{B as c,Q as R}from"./react-toastify.esm-qpFjOtIC.js";/* empty css                      */import{l as T}from"./index-BidzJ-ix.js";import{X as me}from"./index.es-BZINUmGb.js";const ue=[{name:e.jsx("b",{children:"Item"}),selector:r=>r.product.name,wrap:!0},{name:e.jsx("b",{children:"Qty"}),selector:r=>r.quantity,grow:!0,width:"60px",right:!0},{name:e.jsx("b",{children:"Price"}),selector:r=>Intl.NumberFormat("en-US").format(r.product.retail_price),grow:!0,width:"90px",right:!0}],xe=a.forwardRef(({company:r,props:p})=>(console.log(p),oe(),e.jsxs("div",{className:"text-sm text-uppercase monospace",children:[e.jsxs("div",{className:"w-full items-center justify-center space-x-5",children:[e.jsx("div",{className:"flex items-center justify-center w-full",children:e.jsx("img",{src:"/"+r.company.logo,alt:"facility logo",className:"h-20 object-contain rounded-lg mb-2"})}),e.jsxs("div",{className:"flex flex-col mb-4 items-center",children:[e.jsx("div",{className:"text-lg",children:r.company.name}),e.jsxs("div",{className:"my-1",children:["No. ",p.receipts.sale_id]}),e.jsx("div",{children:new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"})}),e.jsx("div",{className:"font-bold mt-1",children:"CUSTOMER BILL"})]})]}),e.jsx(me,{columns:ue,data:p.receipts.sales}),e.jsx("table",{className:"w-full mt-2 bg-transparent",children:e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{className:"font-semibold text-start pl-5 py-2",children:"TOTAL"}),e.jsx("td",{className:"text-end pr-5 font-semibold py-2",children:"UGX "+Intl.NumberFormat("en-US").format(parseFloat(p.receipts.sale_total))})]})})}),e.jsxs("div",{className:"flex justify-between mt-5",children:[e.jsx("div",{className:"text-start pl-5",children:"Served by"}),e.jsx("div",{className:"text-end pr-5",children:r.user.name})]}),e.jsxs("div",{className:"flex flex-col mt-5 mb-4 items-center",children:[e.jsx("div",{children:"Thank you for supporting us!"}),e.jsx("div",{children:r.company.contacts}),e.jsx("div",{children:r.company.location})]})]})));function pe({company:r,service:p,service_id:x,service_items:w,cart_items:l}){const[h,C]=a.useState(0),[j,O]=a.useState(),[_,N]=a.useState(0),[F,A]=a.useState(0),[X,S]=a.useState(null),[I,E]=a.useState(null),[L,G]=a.useState(null),D=a.useRef(),B=a.useRef(),g=s=>E(s),v=s=>G(s);function M(){g(),u.visit(`/dashboard/${r.company.slug}/service/panel`)}function $(){v()}const q=T.useReactToPrint({content:()=>D.current,onAfterPrint:()=>{g(),u.visit(`/dashboard/${r.company.slug}/service/panel`)}}),z=T.useReactToPrint({content:()=>B.current,onAfterPrint:()=>{v()}});a.useEffect(()=>{var s=w.data.map(t=>({value:t.id,label:String(t.name),price:"UGX "+Intl.NumberFormat("en-US").format(t.retail_price)}));f(s)},[w]),a.useEffect(()=>{j==""&&N(0),l.length==0&&C(0);var s=0;l&&l.map(t=>{var d=t.quantity*parseFloat(t.product.retail_price);s=s+d,C(s)})},[l,j]);const W=s=>{s.preventDefault(),A(s.target.value);var t=parseFloat(s.target.value)+(parseFloat(j)-parseFloat(h));N(t)},H=s=>{s.preventDefault(),O(s.target.value);var t=s.target.value-h;N(t)},[Q,f]=a.useState([]),[b,P]=a.useState(null),[V,U]=a.useState(""),Z=s=>{P(s)},Y=async s=>{var t=r.company_id;if(U(s),!s){var d=w.data.map(m=>({value:m.id,label:String(m.name),price:"UGX "+Intl.NumberFormat("en-US").format(m.retail_price)}));f(d);return}try{const m=await axios.get(`/search_services?q=${s}&company_id=${t}`);if(m.data.service_items.data&&m.data.service_items.data){var i=m.data.service_items.data.map(k=>({value:k.id,label:String(k.name),price:"UGX "+Intl.NumberFormat("en-US").format(k.retail_price)}));f(i)}else console.error("unexpected"),f([])}catch(m){console.error("Error fetching services:",m),f([])}},J=({value:s,label:t,available:d,price:i})=>e.jsxs("div",{style:{display:""},children:[e.jsx("div",{className:"text-normal font-semibold",children:t}),e.jsx("div",{className:"flex justify-between",children:e.jsx("div",{className:"text-red-700 text-xs font-semibold",children:i})})]});let[o,y]=a.useState(0);function K(){o==1e3?c.error("1000 is the max number"):(o=o+1,y(parseInt(o)))}function ee(){o==0?c.error("Quantity below 0 is forbidden"):(o=o-1,y(parseInt(o)))}function se(){if(o<1)c.error("Quantity must be 1 or higher");else if(o=="")c.error("Input the quantity");else if(b==null)c.error("Select the service/item");else{var s=r.company.id,t=r.user.id,d=b.value,i=o;u.post("/addtoservice",{service_id:x,quantity:i,product_id:d,company_id:s,user_id:t},{preserveScroll:!0,onSuccess:()=>{c.success(b.label+" added to tab"),P(null),y(0),U("")}})}}function re(s,t){var d=r.company.id;u.post("/delete_service_item",{itemId:s,company_id:d,service_id:x},{preserveScroll:!0,onSuccess:()=>{c.success(t+" removed")}})}function te(){var s=r.company.id;u.post("/empty_service_items",{company_id:s,service_id:x},{preserveScroll:!0,onSuccess:()=>{c.success("Tab as been cleared"),u.visit(`/dashboard/${r.company.slug}/service/panel`)}})}var ae={receipts:{sale_id:x,sale_total:h,sales:l}};function ne(){v("xl"),console.log("oi")}function le(){var s=r.company.id;if(l.length==0)c.error("You cant sale nothing");else{var t=h,d=F;u.post("/record_service_sale",{service_id:x,company_id:s,sale_total:t,discount:d},{preserveScroll:!0,onSuccess:async()=>{c.success("Success");try{const i=await axios.get(`/getlastsale?company_id=${s}`);i.data&&i.data?(S(i.data),g("xl")):(console.error("unexpected"),S(null))}catch(i){console.error("Error fetching products:",i),S(null)}}})}}return e.jsxs("div",{children:[e.jsxs("div",{className:"w-full",children:["Service id ",e.jsx("span",{className:"text-red-800",children:x})]}),e.jsxs("div",{className:"px-5 pt-1",children:[e.jsxs("div",{className:"w-full grid grid-cols-1 gap-3 sm:grid-cols-3 place-items-center class justify-center",children:[e.jsxs("div",{className:"w-full space-y-2 mt-2",children:[e.jsx(n.Input,{type:"number",label:"Amount received",value:j,onChange:H}),l&&l.length==0?e.jsx(e.Fragment,{}):e.jsx(n.Input,{type:"number",label:"Discount Amount",value:F,onChange:W})]}),e.jsx("div",{className:"font-bold text-xl",children:l&&l.length==0?e.jsx(e.Fragment,{}):e.jsxs("span",{className:"text-base font-semibold",children:["Change: UGX ",Intl.NumberFormat("en-US").format(_)]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-bold text-xl mb-1",children:["UGX ",Intl.NumberFormat("en-US").format(h),e.jsx("br",{})]}),e.jsx("button",{onClick:()=>le(),className:"py-2 px-10 rounded-md font-semibold text-base text-gray-100 bg-gradient-to-r from-primary to-secondary hover:bg-red-700",children:"Record Sale"})]})]}),e.jsxs("div",{className:"bg-gray-400 p-2 mt-7 w-full grid grid-cols-1 gap-3 sm:grid-cols-3 place-items-center class justify-center",children:[e.jsx(de,{value:b,onChange:Z,formatOptionLabel:J,options:Q,isClearable:!0,placeholder:"Search for service / item...",onInputChange:Y,noOptionsMessage:()=>"No product found",inputValue:V,className:"w-full",styles:{control:(s,t)=>({...s,borderColor:t.isFocused?"blue":"green"})}}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:ee,className:"bg-primary h-10 w-10 rounded-full flex justify-center items-center",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"white",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 12h14"})})}),e.jsx("input",{type:"number",required:!0,placeholder:"",form:"stock_item_form",className:"rounded-md w-16 flex [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",value:o,onChange:s=>y(s.target.value)}),e.jsx("button",{onClick:K,className:"bg-primary h-10 w-10 rounded-full flex justify-center items-center",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"white",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})})})]}),e.jsxs("button",{onClick:se,className:"rounded-md text-white flex justify-center items bg-gradient-to-r from-primary to-secondary p-2 w-full sm:w-32",children:[" ",e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"white",className:"w-6 h-6 mr-1",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v6m3-3H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})})," Add"]})]}),l&&l.length==0?e.jsx(e.Fragment,{}):e.jsxs("div",{className:"bg-white p-1 rounded-xl mt-1 shadow-md shadow-black",children:[e.jsxs("div",{className:"flex justify-between items-center bg-tertiary px-5 py-2 my-3 ",children:[e.jsx("span",{className:"font-semibold text-base",children:"Items"}),e.jsxs("button",{onClick:()=>ne(),className:"bg-primary flex py-1 px-2 rounded-md text-white hover:bg-secondary md:mr-28",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6 mr-1",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m9 14.25 6-6m4.5-3.493V21.75l-3.75-1.5-3.75 1.5-3.75-1.5-3.75 1.5V4.757c0-1.108.806-2.057 1.907-2.185a48.507 48.507 0 0 1 11.186 0c1.1.128 1.907 1.077 1.907 2.185ZM9.75 9h.008v.008H9.75V9Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm4.125 4.5h.008v.008h-.008V13.5Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"})}),"Print Bill"]})]}),e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-2/6",children:"Product"}),e.jsx("th",{className:"w-1/6",children:"Price (UGX)"}),e.jsx("th",{className:"w-1/6",children:"Qty"}),e.jsx("th",{className:"w-1/6 print:hidden",children:"Action"})]})}),e.jsx("tbody",{className:"text-gray-600 dark:text-gray-100 ",children:l&&l.map(s=>e.jsxs("tr",{className:"w-full justify-end",children:[e.jsx("td",{onClick:()=>c.success(s.product.name),className:"cursor-pointer sm:px-3 py-2 px-1 border-b border-gray-200 dark:border-gray-800 w-1/3",children:s.product.name}),e.jsx("td",{className:"sm:px-3 py-2 px-1 border-b border-gray-200 dark:border-gray-800 ",children:Intl.NumberFormat("en-US").format(s.product.retail_price)}),e.jsx("td",{className:"sm:px-3 py-2 px-1 border-b border-gray-200 dark:border-gray-800",children:s.quantity}),e.jsx("td",{className:"sm:px-3 py-2 px-1 border-b border-gray-200 dark:border-gray-800",children:e.jsx("button",{onClick:()=>re(s.id,s.product.name),className:"bg-red-400 rounded-md p-2",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"white",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"})})})})]},s.id))})]}),e.jsx("div",{className:"flex justify-between items-center bg-tertiary px-5 py-2 mt-5 ",children:e.jsx("button",{onClick:()=>te(),className:"bg-red-400 py-1 px-5 rounded-md text-white hover:bg-primary md:mr-28 p-2",children:"Clear and discard service"})})]})]}),e.jsx(a.Fragment,{children:e.jsxs(n.Dialog,{open:I==="xl",size:I,handler:g,children:[e.jsx(n.DialogHeader,{children:e.jsx(n.Typography,{variant:"h5",color:"blue-gray",children:"Print Receipt"})}),e.jsx("form",{children:e.jsx(n.DialogBody,{divider:!0,className:"h-[29rem] overflow-scroll",children:e.jsx("div",{ref:D,children:e.jsx(ie,{company:r,props:X})})})}),e.jsx(n.DialogFooter,{children:e.jsxs("div",{className:"flex w-full justify-between",children:[e.jsx(n.Button,{onClick:M,variant:"gradient",color:"red",children:"Ignore"}),e.jsx("div",{className:"space-x-2",children:e.jsx(n.Button,{onClick:q,type:"submit",className:"bg-green-500",children:"Print"})})]})})]})}),e.jsx(a.Fragment,{children:e.jsxs(n.Dialog,{open:L==="xl",size:L,handler:v,children:[e.jsx(n.DialogHeader,{children:e.jsx(n.Typography,{variant:"h5",color:"blue-gray",children:"Print Bill"})}),e.jsx("form",{children:e.jsx(n.DialogBody,{divider:!0,className:"h-[29rem] overflow-scroll",children:e.jsx("div",{ref:B,children:e.jsx(xe,{company:r,props:ae})})})}),e.jsx(n.DialogFooter,{children:e.jsxs("div",{className:"flex w-full justify-between",children:[e.jsx(n.Button,{onClick:$,variant:"gradient",color:"red",children:"Ignore"}),e.jsx("div",{className:"space-x-2",children:e.jsx(n.Button,{onClick:z,type:"submit",className:"bg-green-500",children:"Print"})})]})})]})}),e.jsx(R,{}),e.jsx(R,{})]})}pe.layout=r=>e.jsx(ce,{children:r,props:r.props.company});export{pe as default};
