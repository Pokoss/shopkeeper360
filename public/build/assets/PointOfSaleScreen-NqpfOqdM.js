import{r as a,j as e,y as h}from"./app-DwOvXp-6.js";import{L as A}from"./Layout-CMtfkMaI.js";import{S as H}from"./react-select.esm-OuiCVdv1.js";import{Q,B as c}from"./react-toastify.esm-CviXs-Fa.js";/* empty css                      */import{l as Y,R as $}from"./index-SaHEphXP.js";import{r as u}from"./index-LadSfF-I.js";import"./index.es-B10xNckG.js";function V({company:i,products:g,cart_items:d}){console.log(d);const w=a.useRef(),L=Y.useReactToPrint({content:()=>w.current});a.useEffect(()=>{var r=g.data.map(t=>({value:t.id,label:t.name+" ("+t.brand+") -> UGX "+Intl.NumberFormat("en-US").format(t.retail_price),available:t.available}));m(r)},[g]);const[U,m]=a.useState([]),[P,b]=a.useState(null),[f,N]=a.useState(null),[v,j]=a.useState(0),[_,S]=a.useState(0),[y,F]=a.useState(),R=r=>{r.preventDefault(),F(r.target.value);var t=r.target.value-v;S(t)};a.useEffect(()=>{y==""&&S(0),d.length==0&&j(0);var r=0;d&&d.map(t=>{var l=t.quantity*parseFloat(t.product.retail_price);r=r+l,j(r)})},[d,y]);const B=r=>{N(r),console.log(r.value)},[O,k]=a.useState(""),E=({value:r,label:t,available:l})=>e.jsxs("div",{style:{display:""},children:[e.jsx("div",{children:t}),e.jsx("div",{className:"text-green-700 text-sm",children:l+" remaining"})]}),G=async r=>{var t=i.company_id;if(k(r),!r){var l=g.data.map(n=>({value:n.id,label:n.name+" ("+n.brand+") -> UGX "+Intl.NumberFormat("en-US").format(n.retail_price),available:n.available}));m(l);return}try{const n=await axios.get(`/search_stock?q=${r}`,{params:{company_id:t}});if(n.data.product.data&&n.data.product.data){console.log("pro data:",n.data.product.data);var o=n.data.product.data.map(p=>({value:p.id,label:p.name+" ("+p.brand+") -> UGX "+Intl.NumberFormat("en-US").format(p.retail_price),available:p.available}));m(o)}else console.error("unexpected"),m([])}catch(n){console.error("Error fetching products:",n),m([])}};let[s,x]=a.useState(0);function X(){s==1e3?c.error("Best I can do is 10 "+props.name+" tickets"):(s=s+1,x(parseInt(s)))}function q(){s==0?c.error("Seriously!! You want negative tickets"):(s=s-1,x(parseInt(s)))}function D(r,t){var l=i.company.id;h.post("/delete_cart_item",{itemId:r,company_id:l},{preserveScroll:!0,onSuccess:()=>{c.success(t+" removed")}})}function M(){var r=i.company.id;h.post("/empty_cart_item",{company_id:r},{preserveScroll:!0,onSuccess:()=>{j(0),c.success("Cart Cleared")}})}function T(){var r=i.company.id;if(d.length==0)c.error("You cant sale nothing");else{var t=v,l=0;h.post("/register_pay",{company_id:r,sale_total:t,discount:l},{preserveScroll:!0,onSuccess:async()=>{c.success("Success");try{const o=await axios.get("/getlastsale",{company_id:r});console.log(o),o.data&&o.data?(console.log("pro data:",o.data),b(o.data),I("xl")):(console.error("unexpected"),b(null))}catch(o){console.error("Error fetching products:",o),b(null)}}})}}function W(){if(s<1)c.error("Quantity must be 1 or higher");else if(s=="")c.error("Input the quantity");else{var r=i.company.id,t=i.user.id,l=f.value,o=s;h.post("/addtocart",{quantity:o,product_id:l,company_id:r,user_id:t},{preserveScroll:!0,onSuccess:()=>{c.success(f.label+" added to cart"),N(a.useState(null)),x(""),k("")}})}}const[C,z]=a.useState(null),I=r=>z(r);return e.jsxs("div",{children:[e.jsxs("div",{className:"px-5 pt-1",children:[e.jsx("div",{className:"p-2 w-full grid grid-cols-1 gap-3 sm:grid-cols-3 place-items-center class justify-center"}),e.jsxs("div",{className:"w-full grid grid-cols-1 gap-3 sm:grid-cols-3 place-items-center class justify-center",children:[e.jsx(u.Input,{type:"number",label:"Amount received",value:y,onChange:R}),e.jsx("div",{className:"font-bold text-xl",children:e.jsxs("span",{className:"text-base font-semibold",children:["Change: UGX ",Intl.NumberFormat("en-US").format(_)]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-bold text-xl mb-1",children:["UGX ",Intl.NumberFormat("en-US").format(v),e.jsx("br",{})]}),e.jsx("button",{onClick:()=>T(),className:"py-2 px-10 rounded-md font-semibold text-base text-gray-100 bg-primary hover:bg-red-700",children:"Register Pay"})]})]}),e.jsxs("div",{className:"bg-gray-400 p-2 mt-7 w-full grid grid-cols-1 gap-3 sm:grid-cols-3 place-items-center class justify-center",children:[e.jsx(H,{value:f,onChange:B,formatOptionLabel:E,options:U,isClearable:!0,placeholder:"Search for a product...",onInputChange:G,noOptionsMessage:()=>"No product found",inputValue:O,className:"w-full",styles:{control:(r,t)=>({...r,borderColor:(t.isFocused,"brown")})}}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:q,className:"bg-primary h-10 w-10 rounded-full flex justify-center items-center",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"white",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 12h14"})})}),e.jsx("input",{type:"number",required:!0,placeholder:"",form:"stock_item_form",className:"rounded-md w-16 flex [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",value:s,onChange:r=>x(r.target.value)}),e.jsx("button",{onClick:X,className:"bg-primary h-10 w-10 rounded-full flex justify-center items-center",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"white",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})})})]}),e.jsxs("button",{onClick:W,className:"rounded-md flex justify-center items bg-primary p-2 w-full sm:w-32",children:[" ",e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"white",className:"w-6 h-6 mr-1",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v6m3-3H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})})," Add"]})]}),e.jsxs("div",{className:"flex justify-between items-center bg-tertiary px-5 py-2 mt-5",children:[e.jsx("span",{className:"font-semibold text-base",children:"Cart"}),e.jsx("button",{onClick:()=>M(),className:"bg-red-400 py-1 px-5 rounded-md text-white hover:bg-primary md:mr-28",children:"Clear all"})]}),e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-2/6",children:"Product"}),e.jsx("th",{className:"w-1/6",children:"Price (UGX)"}),e.jsx("th",{className:"w-1/6",children:"Qty"}),e.jsx("th",{className:"w-1/6 print:hidden",children:"Action"})]})}),e.jsx("tbody",{className:"text-gray-600 dark:text-gray-100 ",children:d&&d.map(r=>e.jsxs("tr",{className:"w-full justify-end",children:[e.jsx("td",{className:"sm:px-3 py-2 px-1 border-b border-gray-200 dark:border-gray-800 w-1/3",children:r.product.name+" ("+r.product.brand+")"}),e.jsx("td",{className:"sm:px-3 py-2 px-1 border-b border-gray-200 dark:border-gray-800 ",children:Intl.NumberFormat("en-US").format(r.product.retail_price)}),e.jsx("td",{className:"sm:px-3 py-2 px-1 border-b border-gray-200 dark:border-gray-800",children:r.quantity}),e.jsx("td",{className:"sm:px-3 py-2 px-1 border-b border-gray-200 dark:border-gray-800",children:e.jsx("button",{onClick:()=>D(r.id,r.product.name),className:"bg-red-400 rounded-md p-2",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"white",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"})})})})]},r.id))})]})]}),e.jsx(a.Fragment,{children:e.jsxs(u.Dialog,{open:C==="xl",size:C,handler:I,children:[e.jsx(u.DialogHeader,{children:e.jsx(u.Typography,{variant:"h5",color:"blue-gray",children:"Print Receipt"})}),e.jsx("form",{children:e.jsx(u.DialogBody,{divider:!0,className:"h-[29rem] overflow-scroll",children:e.jsx("div",{ref:w,children:e.jsx($,{company:i,props:P})})})}),e.jsx(u.DialogFooter,{children:e.jsxs("div",{className:"flex w-full justify-between",children:[e.jsx(u.Button,{variant:"gradient",color:"red",children:"Ignore"}),e.jsx("div",{className:"space-x-2",children:e.jsx(u.Button,{onClick:L,type:"submit",className:"bg-green-500",children:"Print"})})]})})]})}),e.jsx(Q,{})]})}V.layout=i=>e.jsx(A,{children:i,props:i.props.company});export{V as default};
